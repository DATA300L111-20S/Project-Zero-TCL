<!doctype html>

<!-- Course: DATA 300-111-20S
    Authors: Olivia Carl and Angeli Pinol-->

<html lang="en">

<head>
  <title>Tree Cover Loss in Brazil</title>
  <meta charset="utf=8" />
  <link href="TCL.css" rel="stylesheets" />
  <script type="text/javascript" src="d3.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
  <script src="d3-tip.js"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.10.3/babel.min.js'></script>

  <script>
    window.onload = () => {

      //Choropleth Map
      const brazilMap = d3.select("#choropleth-map")
        .append("svg")
        .attr("width", 700)
        .attr("height", 500);

      var width = +brazilMap.attr("width");
      var height = +brazilMap.attr("height");

      var path = d3.geoPath();
      var projection = d3.geoMercator()
        .scale(600)
        .center([-50, -15])
        .translate([width / 2, height / 2]);

      // Data and color scale
      var data = d3.map();

      var colorScale = d3.scaleThreshold()
        .domain([6, 13, 19])
        .range(d3.schemeGreens[4]);

      const csvPromise = d3.csv("tcl.csv");
      const jsonPromise = d3.json("https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/brazil-states.geojson");

      Promise.all([csvPromise, jsonPromise])
        .then(([data, topo]) => {
          brazilMap.append("g")
            .selectAll("path")
            .data(topo.features)
            .enter()
            .append("path")

            //Draw each country
            .attr("d", d3.geoPath()
              .projection(projection)
            )

            //set color of each country
            .attr("fill", function(d) {
              const state = d.properties.name;
              const stateData = data.filter(row => row.state === state);
              const percent = stateData[0]["percentage"];
              return colorScale(percent);
            });
        });

      //Bar Chart - entire code breaks here with bar chart code

      var groupedBar = d3.select("bar-chart")
        .append("svg")
        .attr("width", 960)
        .attr("height", 500);

      var margin = {
          top: 20,
          right: 20,
          left: 40
        },
        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

      var x0 = d3.scaleBand()
        .rangeRound([0, width], .1);
      var x1 = d3.scaleBand();

      var y = d3.scaleLinear()
        .range([height, 0]);

      var color = d3.scaleBand()
        .range(["#c4d6b0", "#0e402d", "#477998", "#f64740", "#a3333d"]);

      var xAxis = d3.axisBottom()
        .scale(x0);

      var yAxis = d3.axisLeft()
        .scale(y)
        .tickFormat(d3.format(".2s"));

      var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      d3.csv("group.csv", function(error, data) {
        var states = d3.keys(data[0]).filter(function(key) {
          return key !== "Year";
        });

        data.forEach(function(d) {
          d.state = states.map(function(name) {
            return {
              name: name,
              value: +d[name]
            };
          });
        });

        x0.domain(data.map(function(d) {
          return d.Year;
        }));
        x1.domain(states).rangeRound([0, x0.rangeBand()]);
        y.domain([0, d3.max(data, function(d) {
          return d3.max(d.state, function(d) {
            return d.value;
          });
        })]);

        svg.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis);

        svg.append("g")
          .attr("class", "y axis")
          .call(yAxis)
          .append("text")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text("Tree Loss Cover");

        var year = svg.selectAll(".year")
          .data(data)
          .enter().append("g")
          .attr("class", "g")
          .attr("transform", function(d) {
            return "translate(" + x0(d.Year) + ",0)";
          });
        year.selectAll("rect")
          .data(function(d) {
            return d.state;
          })
          .enter().append("rect")
          .attr("width", x1.rangeBand())
          .attr("x", function(d) {
            return x1(d.name);
          })
          .attr("y", function(d) {
            return y(d.value);
          })
          .attr("height", function(d) {
            return height - y(d.value);
          })
          .style("fill", function(d) {
            return color(d.name);
          });
        var legend = svg.selectAll(".legend")
          .data(states.slice().reverse())
          .enter().append("g")
          .attr("class", "legend")
          .attr("transform", function(d, i) {
            return "translate(0," + i * 20 + ")";
          });
        legend.append("rect")
          .attr("x", width - 18)
          .attr("width", 18)
          .attr("height", 18)
          .style("fill", color);
        legend.append("text")
          .attr("x", width - 24)
          .attr("y", 9)
          .attr("dy", ".35em")
          .style("text-anchor", "end")
          .text(function(d) {
            return d;
          });


      });



      //Proportional Symbol Chart
      var symbolData = [{
          "Driver": "Commodity Driven",
          "Amount": "36.41 Mha",
          "x": 0,
          "y": 17.95,
          "w": 364.1,
          "color": "#0E402D"
        },
        {
          "Driver": "Shifting Agriculture",
          "Amount": "11.09 Mha",
          "x": 384.1,
          "y": 144.55,
          "w": 110.9,
          "color": "#477998"
        },
        {
          "Driver": "Forestry",
          "Amount": "5.98 Mha",
          "x": 515,
          "y": 170.1,
          "w": 59.0,
          "color": "#F6474D"
        },
        {
          "Driver": "Others",
          "Amount": "0.38 Mha",
          "x": 594.8,
          "y": 198.1,
          "w": 3.8,
          "color": "#A3333D"
        }
      ];

      const symbol = d3.select("#symbol-chart")
        .append("svg")
        .attr("width", 800)
        .attr("height", 400);

      var squares = symbol.selectAll("rect")
        .data(symbolData)
        .enter()
        .append("rect");

      var squareAttributes = squares
        .attr("x", function(d) {
          return d.x;
        })
        .attr("y", function(d) {
          return d.y;
        })
        .attr("width", function(d) {
          return d.w;
        })
        .attr("height", function(d) {
          return d.w;
        })
        .style("fill", function(d) {
          return d.color;
        });

      symbol.append("text")
        .text("Commodity Driven:")
        .attr("x", 182.05)
        .attr("y", 182.05)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "25px")
        .attr("fill", "white");

      symbol.append("text")
        .text("36.41 Mha")
        .attr("x", 182.05)
        .attr("y", 208.05)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "25px")
        .attr("fill", "white");

      symbol.append("text")
        .text("Shifting Agriculture:")
        .attr("x", 439.55)
        .attr("y", 120)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "17px")
        .attr("fill", "black");

      symbol.append("text")
        .text("11.09 Mha")
        .attr("x", 439.55)
        .attr("y", 137)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "17px")
        .attr("fill", "black");

      symbol.append("text")
        .text("Forestry:")
        .attr("x", 544.5)
        .attr("y", 150)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "17px")
        .attr("fill", "black");

      symbol.append("text")
        .text("5.98 Mha")
        .attr("x", 544.5)
        .attr("y", 165)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "17px")
        .attr("fill", "black");

      symbol.append("text")
        .text("Others*")
        .attr("x", 630)
        .attr("y", 178)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "17px")
        .attr("fill", "black");

      symbol.append("text")
        .text("0.38 Mha")
        .attr("x", 630)
        .attr("y", 193)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "17px")
        .attr("fill", "black");

      //Dual Axis Line Chart
      const tclLineData = [{
          "Year": "2001",
          "TCL": 2.75,
        },
        {
          "Year": "2004",
          "TCL": 3.85,
        },
        {
          "Year": "2007",
          "TCL": 2.62,
        },
        {
          "Year": "2010",
          "TCL": 2.69,
        },
        {
          "Year": "2013",
          "TCL": 1.95,
        },
        {
          "Year": "2016",
          "TCL": 5.38,
        },
        {
          "Year": "2018",
          "TCL": 2.95,
        }
      ]

      const co2LineData = [{
          "Year": "2001",
          "CO2": 0.91,
        },
        {
          "Year": "2004",
          "CO2": 1.37,
        },
        {
          "Year": "2007",
          "CO2": 0.88,
        },
        {
          "Year": "2010",
          "CO2": 0.90,
        },
        {
          "Year": "2013",
          "CO2": 0.59,
        },
        {
          "Year": "2016",
          "CO2": 1.94,
        },
        {
          "Year": "2018",
          "CO2": 1.02,
        }
      ]

      const termtoInt = d => {
        switch (d["Year"]) {
          case "2001":
            return 5;
          case "2004":
            return 10;
          case "2007":
            return 15;
          case "2010":
            return 20;
          case "2013":
            return 25;
          case "2016":
            return 30;
          case "2018":
            return 33;
        }
      }

      const lineChart = d3.select("#line-chart")
        .append("svg")
        .attr("width", 400)
        .attr("height", 270)
        .attr("viewBox", "0 0 40 27");

    }

  </script>
</head>

<body>
  <h1>Tree Cover Loss in Brazil: A Comprehensive Visualization.</h1>
  <section>
    <h4>Deforestation has become, no doubt, one of the leading topics concerning climate change and global sustainability, as its impact can be seen world wide leading to biodiversity loss and political turmoil. Forests make up 31% of the total land area on our planet and provide a vast amount of resources needed to sustain both human and animal life. This is especially concerning in tropical rainforests, such as Brazil, as the consequences of deforestation are vast and surmounting. However, what do we mean by deforestation and what does it look like in Brazil? On this page, we’ve set out to answer these questions with a set of interactive visualizations to understand what tree cover loss is in Brazil.
      Please explore and read the following charts to find out more. </h4>
  </section>
  <section>
    <h2>Percentage of Tree Cover Loss per State in Brazil.</h2>
    <h3>This chart maps the aggregate percentage of tree cover loss in each of Brazil’s states between 2001 and 2018. </h3>
    <!--Choropleth Map-->
    <figure id="choropleth-map"></figure>
  </section>
  <section>
    <h2>Brazil's Top 5 States with Highest Tree Cover Loss from 2001 to 2018.</h2>
    <!--Bar Chart-->
    <figure id="bar-chart"></figure>
  </section>

  <section>
    <h2>Tree Cover Loss by Driving Factor.</h2>
    <h3>The following symbols represent the amount of Mha (million hectare acres) of land that was lost for that specific reason. The size of the symbol correlates to the amount lost. </h3>
    <!--Pro.Symbol Chart-->
    <figure id="symbol-chart"></figure>
    <h4>*Includes tree cover loss driven by Wildfire, Urbanization, and other unknown causes.</h4>
  </section>

  <section>
    <h2>Tree Cover Loss per Year with Carbon Dioxide Emissions.</h2>
    <h3>The loss of tree cover has an underestimated impact on the amount of Co2 it adds into the air every year. As we can see, the amount of Co2 emissions in Brazil follows the amount of tree cover loss. This relationship unveils a deeper importance of tree cover loss and deforestation than most know. </h3>
    <!--Line Chart-->
    <figure id="line-chart"></figure>
  </section>

  <section>
    <h3>Sources and Code References</h3>
    <li> Global Forest Watch </li>
  </section>

</body>

</html>
