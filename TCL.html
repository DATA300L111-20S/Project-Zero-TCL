<!doctype html>

<!-- Course: DATA 300-111-20S
    Authors: Olivia Carl and Angeli Pinol-->

<html lang="en">

<head>
  <title>Tree Cover Loss in Brazil</title>
  <meta charset="utf=8" />
  <link href="TCL.css" rel="stylesheet" />
  <script type="text/javascript" src="d3.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.10.3/babel.min.js'></script>

  <script>
    window.onload = () => {

      //Choropleth Map
      const brazilMap = d3.select("#choropleth-map")
        .append("svg")
        .attr("width", 700)
        .attr("height", 500);

      var width = +brazilMap.attr("width");
      var height = +brazilMap.attr("height");

      var path = d3.geoPath();
      var projection = d3.geoMercator()
        .scale(650)
        .center([-50, -15])
        .translate([width / 2, height / 2]);

      // Data and color scale
      var data = d3.map();

      //Adding tooltip
      const dic = d3.select("g")
        .append("div")
        .attr('class', 'tooltip')
        .style('opacity', 0);

      var colorScale = d3.scaleThreshold()
        .domain([6, 13, 19])
        .range(d3.schemeGreens[4]);

      const csvPromise = d3.csv("tcl.csv");
      const jsonPromise = d3.json("https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/brazil-states.geojson");

      Promise.all([csvPromise, jsonPromise])
        .then(([data, topo]) => {
          brazilMap.append("g")
            .selectAll("path")
            .data(topo.features)
            .enter()
            .append("path")

            //Draw each country
            .attr("d", d3.geoPath()
              .projection(projection)
            )

            //Set color of each country
            .attr("fill", function(d) {
              const state = d.properties.name;
              const stateData = data.filter(row => row.state === state);
              const percent = stateData[0]["percentage"];
              return colorScale(percent);
            })

            //Adding the tooltip
            .on('mouseover', d => {
              div
                .transition()
                .duration(200)
                .style('opacity', 0.9);
              //Continue adding tooltip code here
            });
        });

      //Legend      


      // Grouped Bar Chart
      var GroupBar = d3.select("#bar-chart"),
        margin = {
          top: 20,
          right: 20,
          bottom: 30,
          left: 40
        },

        width = +GroupBar.attr("width") - margin.left - margin.right,
        height = +GroupBar.attr("height") - margin.top - margin.bottom,
        g = GroupBar.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var x0 = d3.scaleBand()
        .rangeRound([0, width], .1);
      var x1 = d3.scaleBand()
        .padding(0.05);

      var y = d3.scaleLinear()
        .rangeRound([height, 0]);

      var color = d3.scaleOrdinal()
        .range(["#1E5631", "#728c69", "#477998", "#FFD933", "#A4DE02"]);

      d3.csv("group.csv", function(error, data) {
        var states = d3.keys(data[0]).filter(function(key) {
          return key !== "Year";
        });
        data.forEach(function(d) {
          d.state = states.map(function(name) {
            return {
              name: name,
              value: +d[name]
            };
          });
        });

        var keys = data.columns.slice(1);

        console.log('keys');
        console.log(keys);
        x0.domain(data.map(function(d) {
          return d.Year;
        }));
        x1.domain(keys).rangeRound([0, x0.bandwidth()]);
        y.domain([0, d3.max(data, function(d) {
          return d3.max(d.state, function(d) {
            return d.value;
          });
        })]).nice();

        g.append("g")
          .selectAll("g")
          .data(data)
          .enter().append("g")
          .attr("class", "bar")
          .attr("transform", function(d) {
            return "translate(" + x0(d.Year) + ",0)";
          })
          .selectAll("rect")
          .data(function(d) {
            return keys.map(function(key) {
              return {
                key: key,
                value: d[key]
              };
            });
          })
          .enter().append("rect")
          .attr("x", function(d) {
            return x1(d.key);
          })
          .attr("y", function(d) {
            return y(d.value);
          })
          .attr("width", x1.bandwidth())
          .attr("height", function(d) {
            return height - y(d.value);
          })
          .attr("fill", function(d) {
            return color(d.key);
          });

        g.append("g")
          .attr("class", "axis")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x0));

        g.append("g")
          .attr("class", "y axis")
          .call(d3.axisLeft(y))
          .append("text")
          .attr("x", 5)
          .attr("y", y(y.ticks().pop()) + 1)
          .attr("dy", "0.50em")
          .attr("fill", "#000")
          .attr("font-weight", "bold")
          .attr("text-anchor", "start")
          .text("Tree Loss Cover");

        var legend = g.append("g")
          .attr("font-family", "sans-serif")
          .attr("font-size", 12)
          .attr("text-anchor", "end")
          .selectAll("g")
          .data(keys.slice().reverse())
          .enter().append("g")
          .attr("transform", function(d, i) {
            return "translate(0," + i * 20 + ")";
          });

        legend.append("rect")
          .attr("x", width)
          .attr("width", 15)
          .attr("height", 15)
          .attr("fill", color)
          .attr("stroke", color)
          .attr("stroke-width", 2)
          .on("click", function(d) {
            update(d)
          });

        legend.append("text")
          .attr("x", width - 14)
          .attr("y", 10)
          .attr("dy", "0.32em")
          .text(function(d) {
            return d;
          });
      });

      //Proportional Symbol Chart
      var symbolData = [{
          "Driver": "Commodity Driven",
          "Amount": "36.41 Mha",
          "x": 0,
          "y": 17.95,
          "w": 364.1,
          "color": "#0E402D"
        },
        {
          "Driver": "Shifting Agriculture",
          "Amount": "11.09 Mha",
          "x": 384.1,
          "y": 144.55,
          "w": 110.9,
          "color": "#477998"
        },
        {
          "Driver": "Forestry",
          "Amount": "5.98 Mha",
          "x": 515,
          "y": 170.1,
          "w": 59.0,
          "color": "#F6474D"
        },
        {
          "Driver": "Others",
          "Amount": "0.38 Mha",
          "x": 594.8,
          "y": 198.1,
          "w": 3.8,
          "color": "#A3333D"
        }
      ];

      const symbol = d3.select("#symbol-chart")
        .append("svg")
        .attr("width", 800)
        .attr("height", 400);

      var squares = symbol.selectAll("rect")
        .data(symbolData)
        .enter()
        .append("rect");

      var squareAttributes = squares
        .attr("x", function(d) {
          return d.x;
        })
        .attr("y", function(d) {
          return d.y;
        })
        .attr("width", function(d) {
          return d.w;
        })
        .attr("height", function(d) {
          return d.w;
        })
        .style("fill", function(d) {
          return d.color;
        });

      symbol.append("text")
        .text("Commodity Driven:")
        .attr("x", 182.05)
        .attr("y", 182.05)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "25px")
        .attr("fill", "white");

      symbol.append("text")
        .text("36.41 Mha")
        .attr("x", 182.05)
        .attr("y", 208.05)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "25px")
        .attr("fill", "white");

      symbol.append("text")
        .text("Shifting Agriculture:")
        .attr("x", 439.55)
        .attr("y", 120)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "17px")
        .attr("fill", "black");

      symbol.append("text")
        .text("11.09 Mha")
        .attr("x", 439.55)
        .attr("y", 137)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "17px")
        .attr("fill", "black");

      symbol.append("text")
        .text("Forestry:")
        .attr("x", 544.5)
        .attr("y", 150)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "17px")
        .attr("fill", "black");

      symbol.append("text")
        .text("5.98 Mha")
        .attr("x", 544.5)
        .attr("y", 165)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "17px")
        .attr("fill", "black");

      symbol.append("text")
        .text("Others*")
        .attr("x", 630)
        .attr("y", 178)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "17px")
        .attr("fill", "black");

      symbol.append("text")
        .text("0.38 Mha")
        .attr("x", 630)
        .attr("y", 193)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "17px")
        .attr("fill", "black");

      //Dual Axis Line Chart

      // set dimensions and margins of the graph
      var margin = {
          top: 20,
          right: 40,
          bottom: 30,
          left: 50
        },
        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;


      // set x and y range
      var x = d3.scaleLinear().rangeRound([0, width]);
      var y1 = d3.scaleLinear().range([height, 0]);
      var y2 = d3.scaleLinear().range([height, 0]);

      // define line1
      var vline1 = d3.line()
        .x(function(d) {
          return x(d.Year);
        })
        .y(function(d) {
          return y1(d.TCL);
        });

      // define line2
      var vline2 = d3.line()
        .x(function(d) {
          return x(d.Year);
        })
        .y(function(d) {
          return y2(d.CO2);
        });

      var DuaLine = d3.select("#line-chart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");
      // Parse data
      d3.csv("dual_line.csv", function(error, data) {
        if (error) throw error;

        // format the data
        data.forEach(function(d) {
          d.Year = parseInt(d.Year);
          d.close = +d.TCL;
          parseInt
          d.open = +d.CO2;
        });

        // Scale the range of the data
        x.domain(d3.extent(data, function(d) {
          return d.Year;
        }));
        y1.domain([0, d3.max(data, function(d) {
          return Math.max(d.TCL);
        })]);
        y2.domain([0, d3.max(data, function(d) {
          return Math.max(d.CO2);
        })]);

        // Add the line path 1.
        svg.append("path")
          .data([data])
          .attr("class", "line")
          .attr("d", vline1);

        // Add the line path 2.
        svg.append("path")
          .data([data])
          .attr("class", "line")
          .style("stroke", "green")
          .attr("d", vline2);

        // Add the X Axis
        svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x));

        // Add the Y1 Axis
        svg.append("g")
          .attr("class", "axisLightGreen")
          .call(d3.axisLeft(y1));

        // Add the Y2 Axis
        svg.append("g")
          .attr("class", "axisDarkGreen")
          .attr("transform", "translate( " + width + ", 0 )")
          .call(d3.axisRight(y2));
      });
    };
  </script>
</head>

<body>
  <h1>Tree Cover Loss in Brazil: A Comprehensive Visualization.</h1>
  <section>
    <h2><a href "https://blog.globalforestwatch.org/data-and-research/when-a-tree-falls-is-it-deforestation"> When a tree falls, is it deforestation?</a></h2>
    <h3>Deforestation has become, no doubt, one of the leading topics concerning climate change and global sustainability, as its impact can be seen world wide leading to biodiversity loss and political turmoil. Forests make up 31% of the total land area on our planet and provide a vast amount of resources needed to sustain both human and animal life. This is especially concerning in tropical rainforests, such as Brazil, as the consequences of deforestation are vast and surmounting. However, what do we mean by deforestation and what does it look like in Brazil? On this page, we’ve set out to answer these questions with a set of interactive visualizations to understand what tree cover loss is in Brazil. <i>Please explore and read the following charts to find out more.</i></h3>
  </section>
  <section>
    <h2>Percentage of Tree Cover Loss per State in Brazil.</h2>
    <h3>This chart maps the aggregate percentage of tree cover loss in each of Brazil’s states between 2001 and 2018. </h3>
    <!--Choropleth Map-->
    <figure id="choropleth-map"></figure>
  </section>
  <section>
    <h2>Brazil's Top 5 States with Highest Tree Cover Loss from 2008 to 2018.</h2>
    <!--Bar Chart-->
    <figure id="bar-chart"></figure>
  </section>

  <section>
    <h2>Tree Cover Loss by Driving Factor.</h2>
    <h3>The following symbols represent the amount of Mha (million hectare acres) of land that was lost for that specific reason. The size of the symbol correlates to the amount lost. </h3>
    <!--Pro.Symbol Chart-->
    <figure id="symbol-chart"></figure>
    <h4>*Includes tree cover loss driven by Wildfire, Urbanization, and other unknown causes.</h4>
  </section>

  <section>
    <h2>Tree Cover Loss per Year with Carbon Dioxide Emissions.</h2>
    <h3>The loss of tree cover has an underestimated impact on the amount of Co2 it adds into the air every year. As we can see, the amount of Co2 emissions in Brazil follows the amount of tree cover loss. This relationship unveils a deeper importance of tree cover loss and deforestation than most know. </h3>
    <!--Line Chart-->
    <figure id="line-chart"></figure>
  </section>

  <section>
    <h3>Sources and Code References</h3>
    <li><a href="https://www.globalforestwatch.org/dashboards/country/BRA?category=summary&dashboardPrompts=eyJvcGVuIjpmYWxzZSwic3RlcEluZGV4IjowLCJzdGVwc0tleSI6InNoYXJlV2lkZ2V0IiwiZm9yY2UiOnRydWV9&map=eyJkYXRhc2V0cyI6W3siZGF0YXNldCI6IjBiMDIwOGI2LWI0MjQtNGI1Ny05ODRmLWNhZGRmYTI1YmEyMiIsImxheWVycyI6WyJjYzM1NDMyZC0zOGQ3LTRhMDMtODcyZS0zYTcxYTJmNTU1ZmMiLCJiNDUzNTBlMy01YTc2LTQ0Y2QtYjBhOS01MDM4YTBkOGJmYWUiXSwiYm91bmRhcnkiOnRydWUsIm9wYWNpdHkiOjEsInZpc2liaWxpdHkiOnRydWV9LHsiZGF0YXNldCI6ImVhYjk2NTVmLWRkMzctNGJiMy1iMjIzLTRjNWRmMTY2NTY0YyIsImxheWVycyI6WyJkY2U4MDA0Zi00ZDBmLTRjMmQtYWU0Yi1kY2Y1NWUxNDAzNWYiXSwib3BhY2l0eSI6MSwidmlzaWJpbGl0eSI6dHJ1ZSwicGFyYW1zIjp7InRocmVzaCI6MzAsInZpc2liaWxpdHkiOnRydWV9fV0sImNlbnRlciI6eyJsYXQiOi0xNS4xMjgzMDA2MDg5NDA5OCwibG5nIjotNTQuMzkxMzAwMDAwMDE4ODh9LCJiZWFyaW5nIjowLCJwaXRjaCI6MCwiem9vbSI6Mi44Mjg1NDU3NDMwMTI0Mzg4LCJjYW5Cb3VuZCI6ZmFsc2UsImJib3giOltdfQ%3D%3D&treeLoss=eyJpbnRlcmFjdGlvbiI6e319&treeLossTsc=eyJpbnRlcmFjdGlvbiI6e30sImhpZ2hsaWdodGVkIjpmYWxzZX0%3D">Global Forest Watch: Brazil Dashboard</a></li>
    <li><a href="https://www.worldwildlife.org/threats/deforestation-and-forest-degradation">World Wildlife Fund</a></li>
    <li> <a href="https://www.reuters.com/article/us-global-forests-emissions-trfn/carbon-emissions-from-tropical-forest-loss-underestimated-scientists-say-idUSKBN1XA1CB">Reuters</a>
    </li>

  </section>

</body></html>
