<!doctype html>

<!-- Course: DATA 300-111-20S
    Authors: Olivia Carl and Angeli Pinol-->

<html lang="en">

<head>
  <title>Tree Cover Loss in Brazil: A Comprehensive Visualization.</title>
  <meta charset="utf=8" />
  <link href="TCL.css" rel="stylesheets" />
  <script type="text/javascript" src="d3.js"></script>

  <script>
    window.onload = () => {

      //Choropleth Map
      var brazilMap = d3.select("#choropleth-map")
        .append("svg")
        .attr("width", 700)
        .attr("height", 500);

      var svg = d3.select("svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

      var path = d3.geoPath();
      var projection = d3.geoMercator()
        .scale(600)
        .center([-50, -15])
        .translate([width / 2, height / 2]);

      // Data and color scale
      var data = d3.map();

      var colorScale = d3.scaleThreshold()
        .domain([6, 13, 19])
        .range(d3.schemeGreens[4]);

      d3.csv("tcl.csv", data => {
        d3.json("https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/brazil-states.geojson", topo => {

          // Draw the map
          svg.append("g")
            .selectAll("path")
            .data(topo.features)
            .enter()
            .append("path")

            //draw each country
            .attr("d", d3.geoPath()
              .projection(projection)
            )

            //set color of each country
            .attr("fill", function(d) {
              const state = d.properties.name;
              const stateData = data.filter(row => row.state === state);
              const percent = stateData[0]["percentage"];
              return colorScale(percent);
            });
        });
      });

      //Bar Chart

      //Proportional Symbol Chart
      const symbol = d3.select("#symbol-chart")
        .append("svg")
        .attr("width", 800)
        .attr("height", 400);

      var rectangle = symbol.append("rect")
        .attr("x", 0)
        .attr("y", 17.95)
        .attr("width", 364.1)
        .attr("height", 364.1)
        .style("fill", "#0E402D");

      var rectangle = symbol.append("rect")
        .attr("x", 384.1)
        .attr("y", 144.55)
        .attr("width", 110.9)
        .attr("height", 110.9)
        .style("fill", "#477998");

      var rectangle = symbol.append("rect")
        .attr("x", 515)
        .attr("y", 170.1)
        .attr("width", 59.8)
        .attr("height", 59.8)
        .style("fill", "#F6474D");

      var rectangle = symbol.append("rect")
        .attr("x", 594.8)
        .attr("y", 198.1)
        .attr("width", 3.8)
        .attr("height", 3.8)
        .style("fill", "#A3333D");

      const symbolData = [{
          "Shifting Agriculture": 11.09
        },
        {
          "Commodity Driven": 36.41
        },
        {
          "Others": 0.38
        },
        {
          "Forestry": 5.98
        }
      ]

      //Dual Axis Line Chart
      const tclLineData = [{
          "Year": "2001",
          "TCL": 2.75,
        },
        {
          "Year": "2004",
          "TCL": 3.85,
        },
        {
          "Year": "2007",
          "TCL": 2.62,
        },
        {
          "Year": "2010",
          "TCL": 2.69,
        },
        {
          "Year": "2013",
          "TCL": 1.95,
        },
        {
          "Year": "2016",
          "TCL": 5.38,
        },
        {
          "Year": "2018",
          "TCL": 2.95,
        }
      ]

      const co2LineData = [{
          "Year": "2001",
          "CO2": 0.91,
        },
        {
          "Year": "2004",
          "CO2": 1.37,
        },
        {
          "Year": "2007",
          "CO2": 0.88,
        },
        {
          "Year": "2010",
          "CO2": 0.90,
        },
        {
          "Year": "2013",
          "CO2": 0.59,
        },
        {
          "Year": "2016",
          "CO2": 1.94,
        },
        {
          "Year": "2018",
          "CO2": 1.02,
        }
      ]

      const termtoInt = d => {
        switch (d["Year"]) {
          case "2001":
            return 5;
          case "2004":
            return 10;
          case "2007":
            return 15;
          case "2010":
            return 20;
          case "2013":
            return 25;
          case "2016":
            return 30;
          case "2018":
            return 33;
        }
      }

      const lineChart = d3.select("#line-chart")
        .append("svg")
        .attr("width", 400)
        .attr("height", 270)
        .attr("viewBox", "0 0 40 27");

      const line1 = d3.line()
        .x(termtoInt)
        .y(d => (8 - d["TCL"]));

      lineChart.append("path")
        .datum(tclLineData)
        .attr("class", "line")
        .attr("d", line1);

      const line2 = d3.line()
        .x(termtoInt)
        .y(d => 3 - d["CO2"]);

      lineChart.append("path")
        .datum(co2LineData)
        .attr("class", "line")
        .attr("d", line2)
    }

  </script>
</head>

<body>
  <h1>Tree Cover Loss in Brazil</h1>
  <section>
    <h2>Percentage of Tree Cover Loss per State in Brazil.</h2>
    <!--Choropleth Map-->
    <figure id="choropleth-map"></figure>
  </section>

  <section>
    <h2>Brazil's Top 5 States with Highest Tree Cover Loss from 2001 to 2018.</h2>
    <!--Bar Chart-->
  </section>

  <section>
    <h2>Tree Cover Loss by Driving Factor.</h2>
    <h3>The symbol's size represents the amount of Mha that that driver has contributed to tree cover loss between 2001 and 2018.</h3>
    <!--Pro.Symbol Chart-->
    <figure id="symbol-chart"></figure>
  </section>

  <section>
    <h2>Tree Cover Loss per Year with Carbon Dioxide Emissions.</h2>
    <!--Line Chart-->
    <figure id="line-chart"></figure>
  </section>

</body>

</html>
