<!doctype html>

<!-- Course: DATA 300-111-20S
    Authors: Olivia Carl and Angeli Pinol-->

<html lang="en">

<head>
  <title>Tree Cover Loss in Brazil: A Comprehensive Visualization.</title>
  <meta charset="utf=8" />
  <link href="TCL.css" rel="stylesheets" />
  <script type="text/javascript" src="d3.js"></script>

  <script>
    window.onload = () => {

      //Choropleth Map
      var brazilMap = d3.select("#choropleth-map")
        .append("svg")
        .attr("width", 700)
        .attr("height", 500);

      var svg = d3.select("svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

      var path = d3.geoPath();
      var projection = d3.geoMercator()
        .scale(600)
        .center([-50, -15])
        .translate([width / 2, height / 2]);

      // Data and color scale
      var data = d3.map();

      var colorScale = d3.scaleThreshold()
        .domain([6, 13, 19])
        .range(d3.schemeGreens[4]);

      d3.csv("tcl.csv", data => {
        d3.json("https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/brazil-states.geojson", topo => {

          // Draw the map
          svg.append("g")
            .selectAll("path")
            .data(topo.features)
            .enter()
            .append("path")

            //draw each country
            .attr("d", d3.geoPath()
              .projection(projection)
            )

            //set color of each country
            .attr("fill", function(d) {
              const state = d.properties.name;
              const stateData = data.filter(row => row.state === state);
              const percent = stateData[0]["percentage"];
              return colorScale(percent);
            });
        });
      });

      //Bar Chart

      //Proportional Symbol Chart
      var symbolData = [{
          "Driver": "Commodity Driven",
          "Amount": "36.41 Mha",
          "x": 0,
          "y": 17.95,
          "w": 364.1,
          "color": "#0E402D"
        },
        {
          "Driver": "Shifting Agriculture",
          "Amount": "11.09 Mha",
          "x": 384.1,
          "y": 144.55,
          "w": 110.9,
          "color": "#477998"
        },
        {
          "Driver": "Forestry",
          "Amount": "5.98 Mha",
          "x": 515,
          "y": 170.1,
          "w": 59.0,
          "color": "#F6474D"
        },
        {
          "Driver": "Others",
          "Amount": "0.38 Mha",
          "x": 594.8,
          "y": 198.1,
          "w": 3.8,
          "color": "#A3333D"
        }
      ];

      const symbol = d3.select("#symbol-chart")
        .append("svg")
        .attr("width", 800)
        .attr("height", 400);

      var squares = symbol.selectAll("rect")
        .data(symbolData)
        .enter()
        .append("rect");

      var squareAttributes = squares
        .attr("x", function(d) {
          return d.x;
        })
        .attr("y", function(d) {
          return d.y;
        })
        .attr("width", function(d) {
          return d.w;
        })
        .attr("height", function(d) {
          return d.w;
        })
        .style("fill", function(d) {
          return d.color;
        });

      var text = symbol.selectAll("text")
        .data(symbolData)
        .enter()
        .append("text");

      var textLabels = text
        .attr("x", function(d) {
          return d.x + (d.w / 2);
        })
        .attr("y", function(d) {
          return d.y + (d.w / 2);
        })
        .text(function(d) {
          return d.Driver + ", " + d.Amount;
        })
        .attr("font-family", "sans-serif")
        .attr("font-size", "15px")
        .attr("fill", "black")
        .attr("text-anchor", "middle");

      //Dual Axis Line Chart
      const tclLineData = [{
          "Year": "2001",
          "TCL": 2.75,
        },
        {
          "Year": "2004",
          "TCL": 3.85,
        },
        {
          "Year": "2007",
          "TCL": 2.62,
        },
        {
          "Year": "2010",
          "TCL": 2.69,
        },
        {
          "Year": "2013",
          "TCL": 1.95,
        },
        {
          "Year": "2016",
          "TCL": 5.38,
        },
        {
          "Year": "2018",
          "TCL": 2.95,
        }
      ]

      const co2LineData = [{
          "Year": "2001",
          "CO2": 0.91,
        },
        {
          "Year": "2004",
          "CO2": 1.37,
        },
        {
          "Year": "2007",
          "CO2": 0.88,
        },
        {
          "Year": "2010",
          "CO2": 0.90,
        },
        {
          "Year": "2013",
          "CO2": 0.59,
        },
        {
          "Year": "2016",
          "CO2": 1.94,
        },
        {
          "Year": "2018",
          "CO2": 1.02,
        }
      ]

      const termtoInt = d => {
        switch (d["Year"]) {
          case "2001":
            return 5;
          case "2004":
            return 10;
          case "2007":
            return 15;
          case "2010":
            return 20;
          case "2013":
            return 25;
          case "2016":
            return 30;
          case "2018":
            return 33;
        }
      }

      const lineChart = d3.select("#line-chart")
        .append("svg")
        .attr("width", 400)
        .attr("height", 270)
        .attr("viewBox", "0 0 40 27");

      const line1 = d3.line()
        .x(termtoInt)
        .y(d => (8 - d["TCL"]));

      lineChart.append("path")
        .datum(tclLineData)
        .attr("class", "line")
        .attr("d", line1);

      const line2 = d3.line()
        .x(termtoInt)
        .y(d => 3 - d["CO2"]);

      lineChart.append("path")
        .datum(co2LineData)
        .attr("class", "line")
        .attr("d", line2)
    }
  </script>
</head>

<body>
  <h1>Tree Cover Loss in Brazil</h1>
  <section>
    <h2>Percentage of Tree Cover Loss per State in Brazil.</h2>
    <!--Choropleth Map-->
    <figure id="choropleth-map"></figure>
  </section>

  <section>
    <h2>Brazil's Top 5 States with Highest Tree Cover Loss from 2001 to 2018.</h2>
    <!--Bar Chart-->
  </section>

  <section>
    <h2>Tree Cover Loss by Driving Factor.</h2>
    <h3>The symbol's size represents the amount of Mha that that driver has contributed to tree cover loss between 2001 and 2018.</h3>
    <!--Pro.Symbol Chart-->
    <figure id="symbol-chart"></figure>
  </section>

  <section>
    <h2>Tree Cover Loss per Year with Carbon Dioxide Emissions.</h2>
    <!--Line Chart-->
    <figure id="line-chart"></figure>
  </section>

</body></html>
